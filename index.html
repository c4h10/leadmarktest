<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>LeadMarkTest</title>

    <script>
      const qString = new URLSearchParams(window.location.search);
      var id;
      var siteid;
      var ipData = {};

      const link_id = qString.get('id');
      const sitd = qString.get('siteId');

      if (link_id) {
        id = link_id;
        localStorage.linkId = link_id;
      } else {
        id = 1;
        localStorage.linkId = 1;
      }

      if (sitd) {
        siteid = sitd;
        localStorage.siteId = sitd;
      } else {
        siteid = 'null';
      }

      (async () => {
        return await fetch('https://ipapi.co/json/', { method: 'GET' } )
          .then(response => {
            if(response.ok){
              return response.json();
            } else {
              return {};
            }
          })
      })().then(res => {
        ipData = res;
      });
    </script>

</head>
<body>
webinar

<style>
    .form-input {
        width: 100%;
        padding: 12px;
        border: 1px solid #333333;
        border-radius: 5px;
        box-sizing: border-box;
        margin-top: 6px;
        margin-bottom: 16px;
        resize: vertical
    }

    .form-submit-btn {
        cursor: pointer;
        padding: 12px 20px;
        border-radius: 5px;
        box-sizing: border-box;
        width: 100%
    }

    .form-submit-btn-contained {
        background-color: #3f51b5;
        color: #ffffff;
        border: none;
    }

    .form-submit-btn-outlined {
        background-color: #fff;
        color: #3f51b5;
        border: 2px #3f51b5 solid;
    }

    .form-container {
        width: 100%;
        border-radius: 5px;
        background-color: transparent;
        padding: 20px;
        box-sizing: border-box;
    }
</style>
<div class="form-container">
    <form id="webinar-registration-form">
        <label for="email"></label><input type="email" id="webinar-registration-form-email" name="email" placeholder="" required="false" class="form-input" >
        <button type="submit" id="webinar-registration-form-submit" class="form-submit-btn form-submit-btn-contained">Submit</button>
    </form>
</div>
<script type="text/javascript">
  window.addEventListener("load", function() {
    const form = document.getElementById("webinar-registration-form");
    form.addEventListener('submit', submitForm);
  });

  function submitForm(e) {
    e.preventDefault();
    const email_value = document.getElementById('webinar-registration-form-email').value;
    let link = `https://api.smartdataprocessor.com/leadintake-test?id=${id}&fName=Trader&lName=NA`;
    link = link + '&email=' + email_value;
    localStorage.setItem('email', email_value);

    link += siteid && siteid !== 'null' ? '&siteid='+siteid : '';
    link += Object.keys(ipData).map(k => '&'+encodeURIComponent(k) + '=' + encodeURIComponent(ipData[k])).join('');
    window.location.href = link;
  }
</script>
</body>
</html>